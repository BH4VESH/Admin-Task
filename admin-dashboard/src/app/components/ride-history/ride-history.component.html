

<!-- ------------------------------------------------------------------------------- -->
<!-- filter -->
<div class="container-fluid ">
    <div class="input-group-prepend ">
        <div class="navbar navbar-dark bg-secondary mt-5 d-flex align-items-center justify-content-center">
            <h1 class="pt-3">Ride History</h1>
          </div>
        <div class="container d-flex pt-5 gap-2">
            <div class="col-6 ">
    
                <select class="custom-select form-control" id="filter-dropdown" [(ngModel)]="statusSearch">
        
                    <option value="" disabled selected>Select Country Code</option>
                    <option value="-1">Select Status</option>
                <option [value]="3">Canceled</option>
                <option [value]="7">Completed</option>
                </select>
                
                <select class="form-control mt-2 " id="filter-dropdown" [(ngModel)]="vehicleSearch" >
                    <option value="">Select a vehicle</option>
                    <option [value]="vehicle._id" *ngFor="let vehicle of vehicleList">{{vehicle.name}}</option>
                </select>
                
            </div>
            <div class="col-6">

                <input class="form-control" type="text" id="search-input" placeholder="Search by Req.Id,Location, Name, Phone," [(ngModel)]="searchText">
        
                <input class="form-control mt-2" type="date" id="search-input" [(ngModel)]="searchDate">
    
            </div>
        </div>
        <!-- btn -->
        <div class="mx-auto container gap-2 d-flex align-items-center justify-content-center mt-3">
                <div class="d-grid gap-2 col-6 mx-auto">
                   <button class="btn btn-info" type="button" id="searchbtn" (click)="performSearch()">Search</button>    
                </div>
                <div class="d-grid gap-2 col-6 mx-auto">    
                   <button class="btn bg-warning text-dark" type="button" id="clearbtn" (click)="clearFields()">Clear</button>
                </div>
        </div>

    </div>
    <hr>

</div>
<!-- table -->
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col">
            <div class="table-responsive">
               
                <table class="table table-striped ">
                    <thead class="bg-light text-dark">
                        <tr>
                            <th>Req Id</th>
                            <th>Username</th>
                            <th>Phone</th>
                            <th>Pick up time</th>
                            <th>Pick up address</th>
                            <th>Drop off address</th>
                            <th>Service type</th>
                            <th>Status</th>
                            <th>Export</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let ride of allRideList;">
                            <td data-bs-toggle="modal" data-bs-target="#infoModel" (click)="rideInfo(ride)">{{ ride._id}}</td>
                            <td data-bs-toggle="modal" data-bs-target="#infoModel" (click)="rideInfo(ride)">{{ride.user.username}}</td>
                            <td data-bs-toggle="modal" data-bs-target="#infoModel" (click)="rideInfo(ride)">{{ ride.user.phone }}</td>
                            <td  data-bs-toggle="modal" data-bs-target="#infoModel" (click)="rideInfo(ride)">{{ ride.scheduledDate | date: 'dd-MM-yyyy' }}</td>
                            <td data-bs-toggle="modal" data-bs-target="#infoModel" (click)="rideInfo(ride)">{{ride.fromLocation}}</td>
                            <td data-bs-toggle="modal" data-bs-target="#infoModel" (click)="rideInfo(ride)">{{ride.toLocation}}</td>
                            <td data-bs-toggle="modal" data-bs-target="#infoModel" (click)="rideInfo(ride)">{{ride.service.name}}</td>

                            
                            <td [ngSwitch]="ride.ridestatus">
                               
                                <span class="btn btn-danger btn-sm" *ngSwitchCase="3" [ngClass]="{'badge-success': ride.ridestatus === 3}">Canceled</span>
                                <span class="btn btn-info btn-sm" *ngSwitchCase="7" [ngClass]="{'badge-success': ride.ridestatus === 7}">Completed</span>
                               
                            </td>
                            <td>
                                <button class="btn bg-light text-dark border btn-sm" (click)="download(ride)"  >Download</button> 
                            </td>
                              
                        
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<!-- Pagination -->
<div class="container-fluid">
    <mat-paginator class="d-flex justify-content-center" hidePageSize="true" [length]="totalItems"
        [pageSize]="itemsPerPage" (page)="onPageChange($event)">
    </mat-paginator>
</div>

<!------------------------------ info model -------------------------->

<div class="modal fade" id="infoModel" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header d-flex justify-content-center bg-info">
                <h2>Ride Information</h2>
            </div>

            <div #mapContainer style="width: 100%; height: 100vh;"></div>

            <div class="modal-body">
                <ng-container *ngFor="let data of infoData">
                    <div class=" d-flex justify-content-between">

                        <div class="">
                            <div>
                                <b>Request Id :</b>
                                <p>{{ data._id }}</p>
                            </div>

                            <div>
                                <b>User Id :</b>
                                <p>{{ data.user._id }}</p>
                            </div>
                            <div>
                                <b>User Name :</b>
                                <p>{{ data.user.username }}</p>
                            </div>
                            <div>
                                <b>User Email :</b>
                                <p>{{ data.user.email }}</p>
                            </div>
                            <div>
                                <b>User Phone :</b>
                                <p>{{ data.user.phone }}</p>
                            </div>

                        </div>

                        <div class="">
                            <b class="me-2">User Profile</b>
                            <p><img [src]="getUserPic(data.user.profilePic)" style="max-width: 50px; max-height: 50px;">
                            </p>
                        </div>
                    </div>
                    <div class=" d-flex justify-content-between">


                        <div class="">
                            <div>
                                <b>Start Location :</b>
                                <p>{{ data.fromLocation }}</p>
                            </div>

                            <div>
                                <b>End Location :</b>
                                <p>{{ data.toLocation }}</p>
                            </div>
                            <div>
                                <b>Stop Point :</b>
                                <ng-container *ngFor="let stop of data.stopValue; let last = last">
                                    {{ stop }}
                                    <ng-container *ngIf="!last">
                                        {{ ', ' }}
                                    </ng-container>
                                    <br>
                                </ng-container>
                            </div>
                            <div>
                                <b>Sevice Type :</b>
                                <p>{{ data.service.name }}</p>
                            </div>
                            <div>
                                <b>Total Distance:</b>
                                <p>{{ data.totalDistanceKm }} Km</p>
                            </div>
                            <div>
                                <b>Total Duration :</b>
                                <p>{{ data.totalDurationMin | durationConvert}}</p>
                            </div>
                            <div>
                                <b>EstimeteFare:</b>
                                <p>â‚¹ {{ data.estimeteFare | number: '1.2-2'}}</p>
                            </div>
                            <div>
                                <b>Booking Time :</b>
                                <p>{{ data.scheduledDate | date: 'medium'}}</p>
                            </div>

                        </div>

                        <div class="">
                            <b class="me-2">Service Profile</b>
                            <p><img [src]="getServiceIcon(data.service.icon)"
                                    style="max-width: 50px; max-height: 50px;"></p>
                                </div>
                            </div>
                            
                        </ng-container>
                        
                
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


